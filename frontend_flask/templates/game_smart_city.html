<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart City Manhunt - AetherMind Surveillance Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            overflow: hidden;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: 100vh;
        }
        
        /* City Map Area */
        .map-area {
            position: relative;
            background: #111;
        }
        #cityCanvas {
            width: 100%;
            height: 100%;
        }
        
        /* Camera Grid Overlay */
        .camera-grid {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            grid-template-columns: repeat(2, 150px);
            gap: 10px;
        }
        .camera-feed {
            background: #000;
            border: 2px solid #333;
            border-radius: 5px;
            overflow: hidden;
        }
        .camera-feed.active {
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255,68,68,0.5);
        }
        .camera-feed.alert {
            border-color: #ff0000;
            animation: pulse-red 0.5s infinite;
        }
        @keyframes pulse-red {
            50% { box-shadow: 0 0 30px rgba(255,0,0,0.8); }
        }
        .camera-header {
            background: rgba(0,0,0,0.8);
            padding: 5px 8px;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .camera-header .rec {
            color: #ff4444;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
        .camera-canvas {
            width: 150px;
            height: 100px;
            background: #000;
        }
        
        /* Alert Banner */
        .alert-banner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,0,0,0.9);
            color: #fff;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            display: none;
            animation: flash 0.3s infinite;
        }
        @keyframes flash {
            50% { opacity: 0.7; }
        }
        
        /* Status Bar */
        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #333;
        }
        .status-item {
            font-size: 12px;
        }
        .status-label { color: #666; }
        .status-value { color: #00ff00; }
        .status-value.danger { color: #ff4444; }
        
        /* Side Panel - Aether's Investigation Log */
        .side-panel {
            background: #0a0a0a;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            background: linear-gradient(180deg, #1a0a0a 0%, #0a0a0a 100%);
        }
        .panel-title {
            color: #ff4444;
            font-size: 18px;
            margin-bottom: 5px;
        }
        .panel-subtitle {
            color: #666;
            font-size: 11px;
        }
        
        /* Case Info */
        .case-info {
            padding: 15px 20px;
            background: rgba(255,68,68,0.1);
            border-bottom: 1px solid #333;
        }
        .case-title {
            color: #ff4444;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .case-detail {
            font-size: 11px;
            margin-bottom: 5px;
            color: #aaa;
        }
        .case-detail span { color: #fff; }
        
        /* Suspect Profile */
        .suspect-profile {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
        }
        .suspect-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .suspect-photo {
            width: 60px;
            height: 60px;
            background: #222;
            border: 2px solid #ff4444;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
        .suspect-desc {
            font-size: 11px;
            color: #aaa;
            line-height: 1.5;
        }
        
        /* Investigation Log */
        .investigation-log {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .log-entry {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 5px;
            border-left: 3px solid #00ff00;
            font-size: 11px;
            line-height: 1.5;
        }
        .log-entry.sighting { border-left-color: #ff4444; background: rgba(255,68,68,0.1); }
        .log-entry.camera { border-left-color: #6bcfff; }
        .log-entry.alert { border-left-color: #ffd93d; }
        .log-time {
            color: #666;
            font-size: 10px;
            margin-bottom: 3px;
        }
        
        /* Police Scanner */
        .scanner-area {
            padding: 15px;
            border-top: 1px solid #333;
            background: rgba(0,0,0,0.5);
        }
        .scanner-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #ffd93d;
            font-size: 12px;
        }
        .scanner-header::before {
            content: 'üìª';
        }
        .scanner-text {
            font-size: 11px;
            color: #888;
            font-style: italic;
            line-height: 1.5;
        }
        
        /* Control Buttons */
        .controls {
            padding: 15px;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
        }
        .ctrl-btn {
            flex: 1;
            padding: 10px;
            background: #222;
            border: 1px solid #444;
            color: #00ff00;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
        }
        .ctrl-btn:hover {
            background: #333;
            border-color: #00ff00;
        }
        .ctrl-btn.danger {
            border-color: #ff4444;
            color: #ff4444;
        }
        .ctrl-btn.danger:hover {
            background: rgba(255,68,68,0.2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="map-area">
            <canvas id="cityCanvas"></canvas>
            
            <!-- Camera Feeds -->
            <div class="camera-grid">
                <div class="camera-feed" id="cam1">
                    <div class="camera-header">
                        <span>CAM-01 Main St</span>
                        <span class="rec">‚óè REC</span>
                    </div>
                    <canvas class="camera-canvas" id="camCanvas1"></canvas>
                </div>
                <div class="camera-feed" id="cam2">
                    <div class="camera-header">
                        <span>CAM-02 Park Ave</span>
                        <span class="rec">‚óè REC</span>
                    </div>
                    <canvas class="camera-canvas" id="camCanvas2"></canvas>
                </div>
                <div class="camera-feed" id="cam3">
                    <div class="camera-header">
                        <span>CAM-03 Oak Blvd</span>
                        <span class="rec">‚óè REC</span>
                    </div>
                    <canvas class="camera-canvas" id="camCanvas3"></canvas>
                </div>
                <div class="camera-feed" id="cam4">
                    <div class="camera-header">
                        <span>CAM-04 River Rd</span>
                        <span class="rec">‚óè REC</span>
                    </div>
                    <canvas class="camera-canvas" id="camCanvas4"></canvas>
                </div>
            </div>
            
            <!-- Alert Banner -->
            <div class="alert-banner" id="alertBanner">
                ‚ö†Ô∏è SUSPECT DETECTED
            </div>
            
            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">STATUS: </span>
                    <span class="status-value danger" id="statusText">ACTIVE MANHUNT</span>
                </div>
                <div class="status-item">
                    <span class="status-label">CAMERAS: </span>
                    <span class="status-value" id="cameraCount">4/4 ONLINE</span>
                </div>
                <div class="status-item">
                    <span class="status-label">SIGHTINGS: </span>
                    <span class="status-value" id="sightingCount">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">TIME ELAPSED: </span>
                    <span class="status-value" id="timeElapsed">00:00</span>
                </div>
            </div>
        </div>
        
        <div class="side-panel">
            <div class="panel-header">
                <div class="panel-title">‚ö° AETHER SURVEILLANCE</div>
                <div class="panel-subtitle">Smart City Manhunt System v2.0</div>
            </div>
            
            <div class="case-info">
                <div class="case-title">üö® ACTIVE CASE #2026-0107</div>
                <div class="case-detail">INCIDENT: <span>Homicide - Domestic</span></div>
                <div class="case-detail">TIME: <span>9:00 AM (5 minutes ago)</span></div>
                <div class="case-detail">LOCATION: <span>1242 Oak Boulevard</span></div>
                <div class="case-detail">VICTIM: <span>Female, 34, Wife of suspect</span></div>
            </div>
            
            <div class="suspect-profile">
                <div class="suspect-header">
                    <div class="suspect-photo">üë§</div>
                    <div>
                        <div style="color:#ff4444;font-size:12px;">SUSPECT</div>
                        <div style="color:#fff;font-size:14px;">White Male</div>
                    </div>
                </div>
                <div class="suspect-desc">
                    Description: White male, approx 35-45 years old. 
                    Last seen wearing dark jacket. Armed and dangerous.
                    Shot wife at residence. Fled on foot heading east.
                </div>
            </div>
            
            <div class="investigation-log" id="investigationLog">
                <!-- Logs will be added here -->
            </div>
            
            <div class="scanner-area">
                <div class="scanner-header">POLICE SCANNER</div>
                <div class="scanner-text" id="scannerText">
                    "All units, all units. We have a 10-71 at 1242 Oak Boulevard. 
                    Witness reports white male suspect fled eastbound on foot. 
                    Suspect is armed. Use caution."
                </div>
            </div>
            
            <div class="controls">
                <button class="ctrl-btn" onclick="startManhunt()">‚ñ∂ START MANHUNT</button>
                <button class="ctrl-btn" onclick="broadcastAlert()">üì¢ BROADCAST ALERT</button>
                <button class="ctrl-btn danger" onclick="resetSimulation()">‚ü≤ RESET</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GAME STATE
        // ============================================
        const State = {
            running: false,
            timeElapsed: 0,
            sightings: [],
            
            // City layout
            streets: [
                { name: 'Main Street', y: 150, horizontal: true },
                { name: 'Park Avenue', y: 300, horizontal: true },
                { name: 'Oak Boulevard', y: 450, horizontal: true },
                { name: 'River Road', y: 550, horizontal: true },
                { name: '1st Street', x: 150, horizontal: false },
                { name: '2nd Street', x: 350, horizontal: false },
                { name: '3rd Street', x: 550, horizontal: false }
            ],
            
            // Camera positions
            cameras: [
                { id: 1, name: 'Main St', x: 200, y: 150, angle: 0, range: 80 },
                { id: 2, name: 'Park Ave', x: 400, y: 300, angle: 0, range: 80 },
                { id: 3, name: 'Oak Blvd', x: 300, y: 450, angle: 0, range: 80 },
                { id: 4, name: 'River Rd', x: 500, y: 550, angle: 0, range: 80 }
            ],
            
            // Crime scene
            crimeScene: { x: 300, y: 450 },
            
            // Suspect (Aether tracks this)
            suspect: {
                x: 320,
                y: 450,
                visible: false,
                path: [], // Predetermined escape route
                pathIndex: 0,
                speed: 1.5,
                lastSeen: null,
                lastSeenCamera: null
            },
            
            // Random civilians (to make it harder)
            civilians: []
        };
        
        // ============================================
        // CANVAS SETUP
        // ============================================
        const cityCanvas = document.getElementById('cityCanvas');
        const cityCtx = cityCanvas.getContext('2d');
        const camCanvases = [1,2,3,4].map(i => ({
            canvas: document.getElementById(`camCanvas${i}`),
            ctx: document.getElementById(`camCanvas${i}`).getContext('2d')
        }));
        
        function resizeCanvas() {
            cityCanvas.width = cityCanvas.offsetWidth;
            cityCanvas.height = cityCanvas.offsetHeight;
            camCanvases.forEach(c => {
                c.canvas.width = 150;
                c.canvas.height = 100;
            });
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ============================================
        // INITIALIZATION
        // ============================================
        function initGame() {
            // Generate suspect escape path
            State.suspect.path = [
                { x: 320, y: 450 },  // Start at crime scene
                { x: 350, y: 450 },  // Move east on Oak Blvd
                { x: 350, y: 380 },  // Turn north
                { x: 400, y: 300 },  // Reach Park Ave (Camera 2!)
                { x: 450, y: 300 },  // Continue east
                { x: 550, y: 300 },  // Reach 3rd Street
                { x: 550, y: 200 },  // Head north
                { x: 550, y: 150 },  // Near Main St
                { x: 600, y: 150 },  // Continue east
                { x: 700, y: 150 },  // Far east - escaping area
            ];
            State.suspect.pathIndex = 0;
            State.suspect.x = State.suspect.path[0].x;
            State.suspect.y = State.suspect.path[0].y;
            
            // Generate some random civilians
            State.civilians = [];
            for (let i = 0; i < 15; i++) {
                State.civilians.push({
                    x: Math.random() * 700 + 50,
                    y: Math.random() * 500 + 100,
                    dx: (Math.random() - 0.5) * 2,
                    dy: (Math.random() - 0.5) * 2,
                    type: Math.random() > 0.5 ? 'walking' : 'standing'
                });
            }
            
            addLog('üîå AETHER SURVEILLANCE SYSTEM ONLINE', '');
            addLog('üì° Connected to city camera network (4 feeds)', 'camera');
            addLog('üö® Received police scanner alert: Homicide at 1242 Oak Blvd', 'alert');
        }

        // ============================================
        // AETHER'S ANALYSIS (The AI Part!)
        // ============================================
        function aetherAnalyzeCamera(camIndex) {
            const cam = State.cameras[camIndex];
            
            // Check if suspect is in camera range
            const dist = Math.hypot(State.suspect.x - cam.x, State.suspect.y - cam.y);
            
            if (dist < cam.range && State.suspect.visible) {
                return {
                    detected: true,
                    confidence: Math.max(0.6, 1 - (dist / cam.range)),
                    position: { x: State.suspect.x, y: State.suspect.y }
                };
            }
            
            // Check civilians
            const civiliansInView = State.civilians.filter(c => 
                Math.hypot(c.x - cam.x, c.y - cam.y) < cam.range
            );
            
            return {
                detected: false,
                civiliansCount: civiliansInView.length,
                civilians: civiliansInView
            };
        }
        
        function aetherProcessSighting(camId, analysis) {
            const cam = State.cameras.find(c => c.id === camId);
            
            State.sightings.push({
                time: State.timeElapsed,
                camera: cam.name,
                position: analysis.position,
                confidence: analysis.confidence
            });
            
            State.suspect.lastSeen = State.timeElapsed;
            State.suspect.lastSeenCamera = cam.name;
            
            document.getElementById('sightingCount').textContent = State.sightings.length;
            
            // Flash the camera feed
            const camElement = document.getElementById(`cam${camId}`);
            camElement.classList.add('alert');
            setTimeout(() => camElement.classList.remove('alert'), 2000);
            
            // Show alert banner
            const banner = document.getElementById('alertBanner');
            banner.style.display = 'block';
            setTimeout(() => banner.style.display = 'none', 1500);
            
            // Log the sighting
            const timeStr = formatTime(State.timeElapsed);
            addLog(
                `üéØ SUSPECT DETECTED!\n` +
                `Camera: ${cam.name}\n` +
                `Confidence: ${(analysis.confidence * 100).toFixed(0)}%\n` +
                `Coordinates: (${Math.round(analysis.position.x)}, ${Math.round(analysis.position.y)})`,
                'sighting'
            );
            
            // Aether's analysis
            setTimeout(() => {
                const direction = predictDirection();
                addLog(
                    `üß† AETHER ANALYSIS:\n` +
                    `Suspect moving ${direction}.\n` +
                    `Alerting nearby patrol units.`,
                    ''
                );
            }, 1000);
        }
        
        function predictDirection() {
            if (State.suspect.pathIndex < State.suspect.path.length - 1) {
                const current = State.suspect.path[State.suspect.pathIndex];
                const next = State.suspect.path[Math.min(State.suspect.pathIndex + 2, State.suspect.path.length - 1)];
                
                if (next.x > current.x) return 'EASTBOUND';
                if (next.x < current.x) return 'WESTBOUND';
                if (next.y < current.y) return 'NORTHBOUND';
                return 'SOUTHBOUND';
            }
            return 'UNKNOWN';
        }

        // ============================================
        // RENDERING
        // ============================================
        function drawCity() {
            // Dark city background
            cityCtx.fillStyle = '#0a0a0a';
            cityCtx.fillRect(0, 0, cityCanvas.width, cityCanvas.height);
            
            // Draw streets
            cityCtx.fillStyle = '#1a1a1a';
            State.streets.forEach(st => {
                if (st.horizontal) {
                    cityCtx.fillRect(0, st.y - 20, cityCanvas.width, 40);
                } else {
                    cityCtx.fillRect(st.x - 20, 0, 40, cityCanvas.height);
                }
            });
            
            // Street labels
            cityCtx.fillStyle = '#333';
            cityCtx.font = '10px monospace';
            State.streets.forEach(st => {
                if (st.horizontal) {
                    cityCtx.fillText(st.name, 600, st.y + 4);
                }
            });
            
            // Draw crime scene
            cityCtx.fillStyle = 'rgba(255,0,0,0.3)';
            cityCtx.beginPath();
            cityCtx.arc(State.crimeScene.x, State.crimeScene.y, 30, 0, Math.PI * 2);
            cityCtx.fill();
            cityCtx.strokeStyle = '#ff0000';
            cityCtx.stroke();
            cityCtx.fillStyle = '#ff0000';
            cityCtx.font = '10px monospace';
            cityCtx.fillText('CRIME SCENE', State.crimeScene.x - 35, State.crimeScene.y + 45);
            
            // Draw camera positions and ranges
            State.cameras.forEach((cam, i) => {
                // Camera range
                cityCtx.beginPath();
                cityCtx.arc(cam.x, cam.y, cam.range, 0, Math.PI * 2);
                cityCtx.fillStyle = 'rgba(0,255,100,0.1)';
                cityCtx.fill();
                cityCtx.strokeStyle = 'rgba(0,255,100,0.3)';
                cityCtx.stroke();
                
                // Camera icon
                cityCtx.fillStyle = '#00ff00';
                cityCtx.fillRect(cam.x - 8, cam.y - 5, 16, 10);
                cityCtx.beginPath();
                cityCtx.moveTo(cam.x + 8, cam.y - 3);
                cityCtx.lineTo(cam.x + 15, cam.y - 8);
                cityCtx.lineTo(cam.x + 15, cam.y + 8);
                cityCtx.lineTo(cam.x + 8, cam.y + 3);
                cityCtx.fill();
                
                cityCtx.font = '9px monospace';
                cityCtx.fillText(`CAM-0${cam.id}`, cam.x - 15, cam.y - 12);
            });
            
            // Draw civilians
            State.civilians.forEach(civ => {
                cityCtx.fillStyle = '#444';
                cityCtx.beginPath();
                cityCtx.arc(civ.x, civ.y, 5, 0, Math.PI * 2);
                cityCtx.fill();
            });
            
            // Draw suspect (red dot)
            if (State.suspect.visible) {
                cityCtx.fillStyle = '#ff0000';
                cityCtx.beginPath();
                cityCtx.arc(State.suspect.x, State.suspect.y, 8, 0, Math.PI * 2);
                cityCtx.fill();
                
                // Pulsing effect
                cityCtx.strokeStyle = `rgba(255,0,0,${0.5 + Math.sin(Date.now() / 200) * 0.3})`;
                cityCtx.lineWidth = 2;
                cityCtx.beginPath();
                cityCtx.arc(State.suspect.x, State.suspect.y, 15, 0, Math.PI * 2);
                cityCtx.stroke();
            }
            
            // Draw last known location marker
            if (State.suspect.lastSeen !== null && State.sightings.length > 0) {
                const lastSighting = State.sightings[State.sightings.length - 1];
                cityCtx.strokeStyle = '#ffd93d';
                cityCtx.setLineDash([5, 5]);
                cityCtx.beginPath();
                cityCtx.arc(lastSighting.position.x, lastSighting.position.y, 25, 0, Math.PI * 2);
                cityCtx.stroke();
                cityCtx.setLineDash([]);
                cityCtx.fillStyle = '#ffd93d';
                cityCtx.font = '9px monospace';
                cityCtx.fillText('LAST SEEN', lastSighting.position.x - 25, lastSighting.position.y - 30);
            }
        }
        
        function drawCameraFeeds() {
            camCanvases.forEach((cam, i) => {
                const camera = State.cameras[i];
                const ctx = cam.ctx;
                
                // Dark background
                ctx.fillStyle = '#0a0a0a';
                ctx.fillRect(0, 0, 150, 100);
                
                // Draw local area around camera
                const scale = 0.8;
                const offsetX = camera.x - 75 / scale;
                const offsetY = camera.y - 50 / scale;
                
                // Streets in view
                ctx.fillStyle = '#1a1a1a';
                State.streets.forEach(st => {
                    if (st.horizontal) {
                        const y = (st.y - offsetY) * scale;
                        if (y > -20 && y < 120) {
                            ctx.fillRect(0, y - 10, 150, 20);
                        }
                    }
                });
                
                // Civilians in view
                State.civilians.forEach(civ => {
                    const x = (civ.x - offsetX) * scale;
                    const y = (civ.y - offsetY) * scale;
                    if (x > -10 && x < 160 && y > -10 && y < 110) {
                        ctx.fillStyle = '#444';
                        ctx.beginPath();
                        ctx.arc(x, y, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                // Suspect in view
                if (State.suspect.visible) {
                    const x = (State.suspect.x - offsetX) * scale;
                    const y = (State.suspect.y - offsetY) * scale;
                    if (x > -10 && x < 160 && y > -10 && y < 110) {
                        ctx.fillStyle = '#ff0000';
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Highlight box
                        ctx.strokeStyle = '#ff0000';
                        ctx.strokeRect(x - 12, y - 12, 24, 24);
                        ctx.fillStyle = '#ff0000';
                        ctx.font = '8px monospace';
                        ctx.fillText('SUSPECT', x - 18, y - 15);
                    }
                }
                
                // Scan line effect
                const scanY = (Date.now() / 20) % 100;
                ctx.strokeStyle = 'rgba(0,255,100,0.3)';
                ctx.beginPath();
                ctx.moveTo(0, scanY);
                ctx.lineTo(150, scanY);
                ctx.stroke();
                
                // Timestamp
                ctx.fillStyle = '#00ff00';
                ctx.font = '8px monospace';
                ctx.fillText(formatTime(State.timeElapsed), 5, 95);
            });
        }

        // ============================================
        // GAME LOOP
        // ============================================
        function update() {
            if (!State.running) return;
            
            // Update time
            State.timeElapsed += 1/60;
            document.getElementById('timeElapsed').textContent = formatTime(State.timeElapsed);
            
            // Move suspect along path
            if (State.suspect.pathIndex < State.suspect.path.length - 1) {
                const target = State.suspect.path[State.suspect.pathIndex + 1];
                const dx = target.x - State.suspect.x;
                const dy = target.y - State.suspect.y;
                const dist = Math.hypot(dx, dy);
                
                if (dist < 5) {
                    State.suspect.pathIndex++;
                } else {
                    State.suspect.x += (dx / dist) * State.suspect.speed;
                    State.suspect.y += (dy / dist) * State.suspect.speed;
                }
            } else {
                // Suspect escaped!
                State.running = false;
                addLog('‚ùå SUSPECT HAS LEFT THE SURVEILLANCE AREA', 'alert');
                addLog(`üìä Final Report:\n- Total sightings: ${State.sightings.length}\n- Last seen: ${State.suspect.lastSeenCamera || 'Unknown'}`, '');
            }
            
            // Move civilians randomly
            State.civilians.forEach(civ => {
                if (civ.type === 'walking') {
                    civ.x += civ.dx;
                    civ.y += civ.dy;
                    
                    // Bounce off edges
                    if (civ.x < 50 || civ.x > 700) civ.dx *= -1;
                    if (civ.y < 100 || civ.y > 600) civ.dy *= -1;
                }
            });
            
            // Aether checks each camera
            State.cameras.forEach((cam, i) => {
                const analysis = aetherAnalyzeCamera(i);
                if (analysis.detected) {
                    // Only log if not recently seen on this camera
                    const recentSighting = State.sightings.find(s => 
                        s.camera === cam.name && State.timeElapsed - s.time < 3
                    );
                    if (!recentSighting) {
                        aetherProcessSighting(cam.id, analysis);
                    }
                }
            });
        }
        
        function render() {
            drawCity();
            drawCameraFeeds();
            requestAnimationFrame(render);
        }

        // ============================================
        // CONTROLS
        // ============================================
        function startManhunt() {
            if (State.running) return;
            
            State.running = true;
            State.suspect.visible = true;
            
            addLog('‚ñ∂ MANHUNT INITIATED', 'alert');
            addLog('üîç Scanning all camera feeds for suspect...', 'camera');
            addLog('üß† AETHER: Beginning systematic search pattern. Will track suspect movement across city grid.', '');
            
            // Start update loop
            setInterval(update, 1000/60);
        }
        
        function broadcastAlert() {
            if (State.sightings.length === 0) {
                addLog('‚ö†Ô∏è No confirmed sightings to broadcast', 'alert');
                return;
            }
            
            const last = State.sightings[State.sightings.length - 1];
            document.getElementById('scannerText').innerHTML = 
                `<strong style="color:#ff4444">BROADCAST:</strong> Suspect last seen at ${last.camera} ` +
                `at ${formatTime(last.time)}. All units respond. Suspect heading ${predictDirection()}.`;
            
            addLog(`üì¢ Alert broadcast to all units: Last seen at ${last.camera}`, 'alert');
        }
        
        function resetSimulation() {
            State.running = false;
            State.timeElapsed = 0;
            State.sightings = [];
            State.suspect.visible = false;
            State.suspect.pathIndex = 0;
            State.suspect.x = State.suspect.path[0].x;
            State.suspect.y = State.suspect.path[0].y;
            State.suspect.lastSeen = null;
            State.suspect.lastSeenCamera = null;
            
            document.getElementById('sightingCount').textContent = '0';
            document.getElementById('timeElapsed').textContent = '00:00';
            document.getElementById('investigationLog').innerHTML = '';
            
            initGame();
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        
        function addLog(message, type = '') {
            const log = document.getElementById('investigationLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            
            const time = document.createElement('div');
            time.className = 'log-time';
            time.textContent = new Date().toLocaleTimeString();
            
            entry.appendChild(time);
            entry.innerHTML += message.replace(/\n/g, '<br>');
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        initGame();
        render();
    </script>
</body>
</html>
